var path        = require('path');
var fs          = require("fs");
var MiniFileUtils=function(){
	
};
/**
* 根据signature+rootPath获得访问该文件的路径
*/
MiniFileUtils.prototype.getFileContentFolder=function(rootPath,signature){
	var sub1 = signature.substring(0,2);
	var sub2 = signature.substring(2,4);
	var sub3 = signature.substring(4,6);
	var sub4 = signature.substring(6,8);
	return path.join(rootPath,sub1,sub2,sub3,sub4,signature);
}
/**
* 递归方式删除空目录，如发现父亲目录是空目录，一并删除
*/
MiniFileUtils.prototype.cleanEmptyFolder=function(folderPath){
	if(!fs.existsSync(folderPath)){
		return;
	}
	var subFiles = fs.readdirSync(folderPath);
	var needClean = true;
	for(var i=0;i<subFiles.length;i++){
		var fileName = subFiles[i];
		if(fileName.indexOf(".")<0){
			needClean = false;
		}
	}
	if(needClean){
		for(var i=0;i<subFiles.length;i++){
			var fileName = subFiles[i];
			var subPath  = path.join(folderPath,fileName);
			fs.unlinkSync(subPath);
		}
		//删除本级目录
		fs.rmdirSync(folderPath);
		//删除父亲目录
		var folderPath = path.dirname(folderPath);
		this.cleanEmptyFolder(folderPath);
	} 
}
exports.MiniFileUtils = MiniFileUtils;