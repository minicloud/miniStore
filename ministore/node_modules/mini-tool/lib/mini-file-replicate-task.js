
var util          = require('util'); 
var EventEmitter  = require('events').EventEmitter;  

function MiniFileReplicateTask(miniHttp,client){
	EventEmitter.call(this); 
	var storeNodeName  = miniHttp.appConfig.name; 
	var hKey           = storeNodeName+"_replicateList"; 
	var signature      = miniHttp.queryParam("signature","");
	var size           = parseInt(miniHttp.queryParam("size",0));
	var downloadUrl    = miniHttp.queryParam("download_url","");
	var callbackUrl    = miniHttp.queryParam("callback_url",""); 
	//把任务请求转移到redis中,定时器定时消费redis的任务
	var task = {
		"callbackUrl":callbackUrl,
		"downloadUrl":downloadUrl,
		"signature":signature,
		"size":size, 
	};
	client.lpush(hKey, JSON.stringify(task));
	//发送任务接受成功请求
	var data = {
			"status":1
	}; 
	var responseData = {
			code:200,
			data:data
	};				
	miniHttp.response(responseData);
} 
exports.MiniFileReplicateTask = MiniFileReplicateTask;
util.inherits(MiniFileReplicateTask, EventEmitter);
